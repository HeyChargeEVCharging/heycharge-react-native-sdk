{"version":3,"names":["React","Animated","Keyboard","StyleSheet","ViewPager","useAnimatedValue","AnimatedViewPager","createAnimatedComponent","PagerViewAdapter","keyboardDismissMode","swipeEnabled","navigationState","onIndexChange","onSwipeStart","onSwipeEnd","children","style","animationEnabled","rest","index","listenersRef","useRef","pagerRef","indexRef","navigationStateRef","position","offset","useEffect","current","jumpTo","useCallback","key","routes","findIndex","route","setPage","setPageWithoutAnimation","setValue","dismiss","onPageScrollStateChanged","state","pageScrollState","nativeEvent","subscription","addListener","value","next","Math","ceil","floor","forEach","listener","removeListener","addEnterListener","push","indexOf","splice","memoizedPosition","useMemo","add","render","styles","container","event","useNativeDriver","e","create","flex"],"sources":["PagerViewAdapter.tsx"],"sourcesContent":["import * as React from 'react';\nimport { Animated, Keyboard, StyleSheet } from 'react-native';\nimport ViewPager, {\n  PageScrollStateChangedNativeEvent,\n} from 'react-native-pager-view';\nimport useAnimatedValue from './useAnimatedValue';\nimport type {\n  NavigationState,\n  Route,\n  Listener,\n  EventEmitterProps,\n  PagerProps,\n} from './types';\n\nconst AnimatedViewPager = Animated.createAnimatedComponent(ViewPager);\n\ntype Props<T extends Route> = PagerProps & {\n  onIndexChange: (index: number) => void;\n  navigationState: NavigationState<T>;\n  children: (\n    props: EventEmitterProps & {\n      // Animated value which represents the state of current index\n      // It can include fractional digits as it represents the intermediate value\n      position: Animated.AnimatedInterpolation;\n      // Function to actually render the content of the pager\n      // The parent component takes care of rendering\n      render: (children: React.ReactNode) => React.ReactNode;\n      // Callback to call when switching the tab\n      // The tab switch animation is performed even if the index in state is unchanged\n      jumpTo: (key: string) => void;\n    }\n  ) => React.ReactElement;\n};\n\nexport default function PagerViewAdapter<T extends Route>({\n  keyboardDismissMode = 'auto',\n  swipeEnabled = true,\n  navigationState,\n  onIndexChange,\n  onSwipeStart,\n  onSwipeEnd,\n  children,\n  style,\n  animationEnabled,\n  ...rest\n}: Props<T>) {\n  const { index } = navigationState;\n\n  const listenersRef = React.useRef<Listener[]>([]);\n\n  const pagerRef = React.useRef<ViewPager>();\n  const indexRef = React.useRef<number>(index);\n  const navigationStateRef = React.useRef(navigationState);\n\n  const position = useAnimatedValue(index);\n  const offset = useAnimatedValue(0);\n\n  React.useEffect(() => {\n    navigationStateRef.current = navigationState;\n  });\n\n  const jumpTo = React.useCallback(\n    (key: string) => {\n      const index = navigationStateRef.current.routes.findIndex(\n        (route: { key: string }) => route.key === key\n      );\n\n      if (animationEnabled) {\n        pagerRef.current?.setPage(index);\n      } else {\n        pagerRef.current?.setPageWithoutAnimation(index);\n        position.setValue(index);\n      }\n    },\n    [animationEnabled, position]\n  );\n\n  React.useEffect(() => {\n    if (keyboardDismissMode === 'auto') {\n      Keyboard.dismiss();\n    }\n\n    if (indexRef.current !== index) {\n      if (animationEnabled) {\n        pagerRef.current?.setPage(index);\n      } else {\n        pagerRef.current?.setPageWithoutAnimation(index);\n        position.setValue(index);\n      }\n    }\n  }, [keyboardDismissMode, index, animationEnabled, position]);\n\n  const onPageScrollStateChanged = (\n    state: PageScrollStateChangedNativeEvent\n  ) => {\n    const { pageScrollState } = state.nativeEvent;\n\n    switch (pageScrollState) {\n      case 'idle':\n        onSwipeEnd?.();\n        return;\n      case 'dragging': {\n        const subscription = offset.addListener(({ value }) => {\n          const next =\n            index + (value > 0 ? Math.ceil(value) : Math.floor(value));\n\n          if (next !== index) {\n            listenersRef.current.forEach((listener) => listener(next));\n          }\n\n          offset.removeListener(subscription);\n        });\n\n        onSwipeStart?.();\n        return;\n      }\n    }\n  };\n\n  const addEnterListener = React.useCallback((listener: Listener) => {\n    listenersRef.current.push(listener);\n\n    return () => {\n      const index = listenersRef.current.indexOf(listener);\n\n      if (index > -1) {\n        listenersRef.current.splice(index, 1);\n      }\n    };\n  }, []);\n\n  const memoizedPosition = React.useMemo(\n    () => Animated.add(position, offset),\n    [offset, position]\n  );\n\n  return children({\n    position: memoizedPosition,\n    addEnterListener,\n    jumpTo,\n    render: (children) => (\n      <AnimatedViewPager\n        {...rest}\n        ref={pagerRef}\n        style={[styles.container, style]}\n        initialPage={index}\n        keyboardDismissMode={\n          keyboardDismissMode === 'auto' ? 'on-drag' : keyboardDismissMode\n        }\n        onPageScroll={Animated.event(\n          [\n            {\n              nativeEvent: {\n                position: position,\n                offset: offset,\n              },\n            },\n          ],\n          { useNativeDriver: true }\n        )}\n        onPageSelected={(e) => {\n          const index = e.nativeEvent.position;\n          indexRef.current = index;\n          onIndexChange(index);\n        }}\n        onPageScrollStateChanged={onPageScrollStateChanged}\n        scrollEnabled={swipeEnabled}\n      >\n        {children}\n      </AnimatedViewPager>\n    ),\n  });\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n});\n"],"mappings":"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"}